{
  "AutomaticReconnect": true,
  "SerialPortName": "COM7",
  "StartupDelayMs": 0,
  "IsConnecting": false,
  "IsEnabled": true,
  "LogIncomingData": true,
  "IsConnected": true,
  "BaudRate": 115200,
  "UpdateMessages": [
    {
      "Message": {
        "Interpreter": 1,
        "Expression": "var lsn = [$prop('Settings.LeftShoulderNeutral')];\r\nvar rsn = [$prop('Settings.RightShoulderNeutral')];\r\nvar lwn = [$prop('Settings.LeftWaistNeutral')];\r\nvar rwn = [$prop('Settings.RightWaistNeutral')];\r\n\r\nvar lsm = [$prop('Settings.LeftShoulderMax')];\r\nvar rsm = [$prop('Settings.RightShoulderMax')];\r\nvar lwm = [$prop('Settings.LeftWaistMax')];\r\nvar rwm = [$prop('Settings.RightWaistMax')];\r\n\r\nvar ctlCount = 5;\r\nvar valCount = 255 - ctlCount;\r\n\r\nvar lsCtl = 0;\r\nvar rsCtl = 1;\r\nvar lwCtl = 2;\r\nvar rwCtl = 3;\r\n\r\nfunction calcAbsFromPct(pct){\r\n  return (pct / 100) * (valCount);\r\n}\r\n\r\nfunction getCommandValFromAbs(abs){\r\n  return abs + ctlCount;\r\n}\r\n\r\nvar lsnPos = calcAbsFromPct(lsn);\r\nvar rsnPos = calcAbsFromPct(rsn);\r\nvar lwnPos = calcAbsFromPct(lwn);\r\nvar rwnPos = calcAbsFromPct(rwn);\r\n\r\nfunction concatCommand(command, servoIndex, val){\r\n  var above127Ctl = 4;\r\n  command = command.concat(String.fromCharCode(servoIndex));\r\n  if (val > 127) {\r\n    val -= 127;\r\n    command = command.concat(String.fromCharCode(above127Ctl));\r\n  }\r\n  val = Math.min(~~val, 127);\r\n  command = command.concat(String.fromCharCode(~~val));\r\n  return command;\r\n}\r\n\r\nfunction applyNeutralOffset(offsetPos, decimalValue){\r\n  decimalValue = Math.max(Math.min(decimalValue, 1), -1);\r\n  var posValue = offsetPos;\r\n  if (decimalValue > 0) {\r\n    posValue = offsetPos + ((valCount - offsetPos) * decimalValue)\r\n  } else if (decimalValue < 0) {\r\n    posValue = offsetPos - (offsetPos * Math.abs(decimalValue))\r\n  }\r\n  return posValue;\r\n}\r\n\r\nfunction getMaxTensionPos(offsetPos, maxVal){\r\n  return applyNeutralOffset(offsetPos, (maxVal / 100));\r\n}\r\n\r\nif ($prop('Settings.TestNeutralTensions')) {\r\n  var command = \"\";\r\n  command = concatCommand(command, lsCtl, getCommandValFromAbs(lsnPos));\r\n  command = concatCommand(command, rsCtl, getCommandValFromAbs(rsnPos));\r\n  command = concatCommand(command, lwCtl, getCommandValFromAbs(lwnPos));\r\n  command = concatCommand(command, rwCtl, getCommandValFromAbs(rwnPos));\r\n  return command;\r\n} else if ($prop('Settings.TestMaxTensions')) {\r\n  var command = \"\";\r\n  command = concatCommand(command, lsCtl, getCommandValFromAbs(getMaxTensionPos(lsnPos, lsm)));\r\n  command = concatCommand(command, rsCtl, getCommandValFromAbs(getMaxTensionPos(rsnPos, rsm)));\r\n  command = concatCommand(command, lwCtl, getCommandValFromAbs(getMaxTensionPos(lwnPos, lwm)));\r\n  command = concatCommand(command, rwCtl, getCommandValFromAbs(getMaxTensionPos(rwnPos, rwm)));\r\n  return command;\r\n}\r\n"
      },
      "IsEnabled": true,
      "MaximumFrequency": 0
    },
    {
      "Message": {
        "Interpreter": 1,
        "Expression": "// G-forces from SimHub properties\r\nvar Gy = - $prop('AccelerationSway');\t// lateral (yaw) acceleration\r\nvar Gs = - $prop('GlobalAccelerationG');\t// deceleration\r\nvar tmax = $prop('Settings.tmax') & 126;\t// limit servos\r\nGy *= $prop('Settings.yaw_gain');\r\nGs *= $prop('Settings.decel_gain');\r\nif (0 > Gs)\r\n  Gs = 0;\t\t\t\t// non-negative deceleration\r\n/*  \r\nelse if (tmax < Gs)\r\n  $prop('Settings.decel_gain') *= Math.round(tmax/Gs - 0.5);\t// unsupported..\r\n */\r\n// convert speed and yaw changes to left and right tension values\r\n// turning right should increase right harness tension (body pushed left)\r\nvar r = Math.sqrt(Gs*Gs + Gy*Gy);\r\nvar l = Gs + Gs - r;\r\nif (0 > Gy) {\r\n  var t = r;\t// negative Gy increases left tension\r\n  r = l;\r\n  l = t;\r\n}\r\n\r\n// Low-pass IIR filtering of left and right tension values\r\nif (null == root[\"lb4\"]) {\r\n  root[\"rb4\"] = r;  root[\"lb4\"] = l;\t// initialize\r\n}\r\nvar rb4 = root[\"rb4\"];\r\nvar lb4 = root[\"lb4\"]; // previously filtered values\r\nvar tc = 1 + $prop('Settings.smooth');\r\nrb4 += (r - rb4) / tc;\r\nlb4 += (l - lb4) / tc;\r\nroot[\"lb4\"] = lb4;\r\nroot[\"rb4\"] = rb4;\r\n\r\nl = lb4; r = rb4; // filtered tensions;  comment out for unfiltered (or set Settings.smooth = 1)\r\nif (l > tmax)\r\n  l = tmax;\r\nelse if (l < 2)\r\n  l = 2;\r\nl &= 0x7E;      // left lsb is 0\r\ntmax |= 1;\r\nif (r > tmax)\r\n  r = tmax;\r\nelse if (r < 3)\r\n  r = 3;\r\nr |= 1;         // right lsb is 1\r\n\r\nif ($prop('Settings.max_test') || $prop('Settings.TestOffsets')) {\r\n  // disable normal message output\r\n  // slider changes will provoke first message outputs\r\n  root[\"rb4\"] = root[\"lb4\"] = 0;  // reset IIR filters\r\n} else {\r\n//* servo control output\r\n  var ls = String.fromCharCode(l);      // tension control characters\r\n  var rs = String.fromCharCode(r);\r\n//*/\r\n\r\n/* gnuplot output **************************************\r\n  var s = $prop('SpeedMph');\r\n  var ls = l.toString();\r\n  var rs = r.toString();\r\n  var ss = s.toString();\r\n  var Gys = Gy.toString();\r\n  var Gss = Gs.toString();\r\n  rs = ls.concat('\\t',rs,'\\r\\n');  // gnuplot columns\r\n  ls = ss.concat('\\t'); \r\n*/\r\nreturn ls.concat(rs);\r\n}"
      },
      "IsEnabled": false,
      "MaximumFrequency": 0
    }
  ],
  "OnConnectMessage": {
    "Expression": ""
  },
  "OnDisconnectMessage": {
    "Expression": ""
  },
  "DtrEnable": true,
  "RtsEnable": false,
  "EditorExpanded": true,
  "Name": "Custom Serial device",
  "Description": "Four Servo Belt Tensioner",
  "LastErrorDate": "2022-12-03T15:58:25.2569011-05:00",
  "LastErrorMessage": null,
  "IsFreezed": false,
  "SettingsBuilder": {
    "Settings": [
      {
        "Settings": [
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "LeftShoulderNeutral",
            "CurrentValue": 27,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Left Shoulder",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "RightShoulderNeutral",
            "CurrentValue": 34,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Right Shoulder",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "LeftWaistNeutral",
            "CurrentValue": 29,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Left Waist",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "RightWaistNeutral",
            "CurrentValue": 19,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "RightWaist",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "PropertyName": "TestNeutralTensions",
            "CurrentValue": false,
            "Name": null,
            "TypeName": "BoolEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Test Neutral Tensions",
            "IsVisibleFormula": {
              "Expression": ""
            }
          }
        ],
        "Name": null,
        "TypeName": "GroupEntry",
        "IsEnabled": true,
        "IsEnabledFormula": {
          "Expression": ""
        },
        "IsVisible": true,
        "Label": "Neutral Tension Settings",
        "IsVisibleFormula": {
          "Expression": ""
        }
      },
      {
        "Settings": [
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "LeftShoulderMax",
            "CurrentValue": 88,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Left Shoulder",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "RightShoulderMax",
            "CurrentValue": 100,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Right Shoulder",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "LeftWaistMax",
            "CurrentValue": 100,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Left Waist",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "RightWaistMax",
            "CurrentValue": 100,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Right Waist",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "PropertyName": "TestMaxTensions",
            "CurrentValue": false,
            "Name": null,
            "TypeName": "BoolEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Test Maximum Tensions",
            "IsVisibleFormula": {
              "Expression": ""
            }
          }
        ],
        "Name": null,
        "TypeName": "GroupEntry",
        "IsEnabled": true,
        "IsEnabledFormula": {
          "Expression": ""
        },
        "IsVisible": true,
        "Label": "Maximum Tension Settings",
        "IsVisibleFormula": {
          "Expression": ""
        }
      },
      {
        "Settings": [
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "LeftShoulderMin",
            "CurrentValue": 27,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Left Shoulder",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "RightShoulderMin",
            "CurrentValue": 34,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Right Shoulder",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "LeftWaistMin",
            "CurrentValue": 29,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Left Waist",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "RightWaistMin",
            "CurrentValue": 19,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "RightWaist",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "PropertyName": "TestMinTensions",
            "CurrentValue": false,
            "Name": null,
            "TypeName": "BoolEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "Test Minimum Tensions",
            "IsVisibleFormula": {
              "Expression": ""
            }
          }
        ],
        "Name": null,
        "TypeName": "GroupEntry",
        "IsEnabled": true,
        "IsEnabledFormula": {
          "Expression": ""
        },
        "IsVisible": true,
        "Label": "Minimum Tension Settings",
        "IsVisibleFormula": {
          "Expression": ""
        }
      },
      {
        "Settings": [
          {
            "Maximum": 100,
            "Minimum": 0,
            "PropertyName": "decel_gain",
            "CurrentValue": 69,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "decel gain",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 80,
            "Minimum": 0,
            "PropertyName": "yaw_gain",
            "CurrentValue": 13,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "delta yaw gain",
            "IsVisibleFormula": {
              "Expression": ""
            }
          },
          {
            "Maximum": 4,
            "Minimum": 0,
            "PropertyName": "smooth",
            "CurrentValue": 2,
            "Name": null,
            "TypeName": "SliderEntry",
            "IsEnabled": true,
            "IsEnabledFormula": {
              "Expression": ""
            },
            "IsVisible": true,
            "Label": "smoothing",
            "IsVisibleFormula": {
              "Expression": ""
            }
          }
        ],
        "Name": null,
        "TypeName": "GroupEntry",
        "IsEnabled": true,
        "IsEnabledFormula": {
          "Expression": ""
        },
        "IsVisible": true,
        "Label": "Sim Settings",
        "IsVisibleFormula": {
          "Expression": ""
        }
      }
    ],
    "IsEditMode": false
  }
}